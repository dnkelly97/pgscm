{% extends 'base.html' %}
{% load static %}

{% block content %}

<br>

<div class="row">
	<div class="col-md-4">
		<div class="card card-body">
            {%  block content1 %}
            <h5 class="card-header">Query Students</h5><br>
			<form id="query-form" method="get">
                {% csrf_token %}
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.name.label}}</span>
                    </div>
                    {{student_filter.form.name}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.school_year.label}}</span>
                    </div>
                    {{student_filter.form.school_year}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.degree.label}}</span>
                    </div>
                    {{student_filter.form.degree}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.university.label}}</span>
                    </div>
                    {{student_filter.form.university}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.gpa.label}}</span>
                    </div>
                    {{student_filter.form.gpa}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.ethnicity.label}}</span>
                    </div>
                    {{student_filter.form.ethnicity}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.gender.label}}</span>
                    </div>
                    {{student_filter.form.gender}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.country.label}}</span>
                    </div>
                    {{student_filter.form.country}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.us_citizenship.label}}</span>
                    </div>
                    {{student_filter.form.us_citizenship}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.first_generation.label}}</span>
                    </div>
                    {{student_filter.form.first_generation}}
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">{{student_filter.form.military.label}}</span>
                    </div>
                    {{student_filter.form.military}}
                </div>

                <div class="input-group mb-3">
                    {{save_query_form.query_name.as_hidden}}
                </div>
                <div class="input-group mb-3">
                    {{save_query_form.description.as_hidden}}
                </div>

		        <button id="id_submit_filter" class="btn btn-primary" type="submit">Search</button>
                <button id="id_save_query" class="btn btn-primary" action="{% url 'run_query' %}" type="submit">Save Query</button>
                <div id="feedback-message"></div>
		    </form>
            {% endblock %}

		</div>
	</div>

    <div class="col-md-8">
        <div class="card card-body">
            <h4 class="card-header">Students
                <small class="float-sm-right">
                    <form action="{% url 'create' %}">
                        <button id="create_student_button" class="btn btn-primary" type="submit">Create Students</button>
                    </form>
                </small>
            </h4>
            <table class="table table-sm">
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Country</th>
                    <th>University</th>
                </tr>

                {% for student in students %}
                <tr>
                    <td>{{student.first_name}}</td>
                    <td>{{student.last_name}}</td>
                    <td>{{student.email}}</td>
                    <td>{{student.country}}</td>
                    <td>{{student.university}}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>

<div>
    <form>

    </form>
</div>

<div>
{% for key, value in request.GET.items %}
    <p>{{key}} = {{value}}</p>
{% endfor %}
</div>

<div class="modal" tabindex="-1" role="dialog" id="save_query_model">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Save changes</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}


{% block javascript %}
<script type="text/javascript">
$(document).ready(function() {
        $("#id_save_query").on('click', function(event) {
            event.preventDefault();
            $('#save_query_model').modal();
        });
});
</script>

<!--script type="text/javascript">
    console.log("what");
    $(document).ready(function() {
        $("#id_save_query").on('click', function(event) {
           event.preventDefault();
           console.log($('#query-form').serialize());
           $.ajax({ data: $('#query-form').serialize(),
                    type: 'post',
                    url: $(this).attr('action'),
                    success: function(response) {
                         console.log(response);
                         if(response['success']) {
                             $("#feedbackmessage").html("<div class='alert alert-success'>Succesfully sent feedback, thank you!</div>");
                             $("#id_save_query").addClass("hidden");
                         }
                         if(response['error']) {
                             $("#feedback-message").html("<div class='alert alert-danger'>" +
                                   response['error']['comment'] +"</div>");
                         }
                    },
                    error: function (request, status, error) {
                         console.log(request.responseText);
                    }
           });
       });
    })
</script-->
{% endblock javascript %}

